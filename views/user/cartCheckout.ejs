<%- include("../partials/header") %>

<a href="/myShoppingCart">Back to Shopping Cart</a>

<h1>Welcome to the checkout, <%= user.username %></h1>
<h4>Please make sure everything is in order. If you need to change anything, you can return to the shopping cart <a href="/myShoppingCart">here.</a></h4>
<br>
<h2>Order Summary</h2><br>
<% cartitems.forEach( product => { %>
    <div>
        <p><strong><%= product.title %></strong></p>
        <p>Price per bottle: <%= product.price %> sek</p>
        <p>Quantity: <%= product.quantity %></p>
        <p>Totalprice: <%= product.total %> sek</p>
    </div><br>
<% }) %>

<div>
    <h4>Total Amount for all items: <%= totalAmount %> sek</h4>
</div><br>

<div>
    <button type="submit" class="checkoutBtn">Proceed to Payment</button>
</div><br>

<%- include("../partials/footer") %>

<script src="https://js.stripe.com/v3/"></script>
<script>
    let stripe = Stripe('pk_test_51ILlk5A4cjb7v0LJ2qQ6WPlVDhaO6qHJZDuNagUhqanLSzfA2DGKCbdULhbngJBYDRunfGv3o8kMK7Okd9yAzbG900WhYHDwz9');
    document.querySelector(".checkoutBtn").addEventListener( "click", () => {
        stripe.redirectToCheckout({ sessionId: "<%= sessionId %>" });
    })
</script>